name: Test Dispatch PAT

on:
  workflow_dispatch:

jobs:
  test_dispatch:
    runs-on: ubuntu-latest
    env:
      DISPATCH: ${{ secrets.DISPATCH }}  # <- set the PAT here

    steps:
      - name: Test dispatch to Craft-Froala-WYSIWYG-A
        run: |
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token $DISPATCH" \
            https://api.github.com/repos/rajani0406/Craft-Froala-WYSIWYG-A/dispatches \
            -d '{"event_type":"test-dispatch"}')
          
          echo "HTTP status: $RESPONSE"

          if [ "$RESPONSE" -eq 204 ]; then
            echo "✅ Dispatch PAT works for Craft-Froala-WYSIWYG-A"
          else
            echo "❌ Dispatch PAT failed for Craft-Froala-WYSIWYG-A"
            exit 1
          fi

      - name: Test dispatch to yii2-froala-editor-B
        run: |
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token $DISPATCH" \
            https://api.github.com/repos/rajani0406/yii2-froala-editor-B/dispatches \
            -d '{"event_type":"test-dispatch"}')

          echo "HTTP status: $RESPONSE"

          if [ "$RESPONSE" -eq 204 ]; then
            echo "✅ Dispatch PAT works for yii2-froala-editor-B"
          else
            echo "❌ Dispatch PAT failed for yii2-froala-editor-B"
            exit 1
          fi
